[project]
name = "audio-extraction-analysis"
version = "1.0.0+emergency"
description = "Audio extraction and transcription analysis tool with multiple providers (Deepgram, ElevenLabs)"
authors = [{name = "Your Name", email = "your.email@example.com"}]
readme = "README.md"
license = {text = "MIT"}
requires-python = ">=3.8"
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Multimedia :: Sound/Audio :: Analysis",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
]
dependencies = [
    "deepgram-sdk>=4.8.1,<5.0.0",
    "elevenlabs>=1.0.0,<2.0.0",
    "python-dotenv>=1.0.0,<2.0.0",
    "rich>=13.0.0",
    "pydantic>=2.4,<3",
    "networkx>=3.1,<4",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.0.0",
    "pytest-asyncio>=0.21.0",
    "pytest-cov>=4.0.0",
    "pytest-mock>=3.10.0",
    "pytest-timeout>=2.1.0",
    "black>=23.0.0",
    "ruff>=0.4.0",
    "pre-commit>=3.0.0",
    "bandit>=1.7.6",
    "pip-audit>=2.4.14",
    "detect-secrets>=1.4.0",
    "import-linter>=2.0",
    "responses>=0.24.0",
]

parakeet = [
    "nemo-toolkit[asr]>=1.20.0",
    "torch>=2.0.0",
    "torchaudio>=2.0.0",
    "tensorboard>=2.14.0",
    "hydra-core>=1.3.0",
    "omegaconf>=2.3.0",
    "pytorch-lightning>=2.0.0",
    "webdataset>=0.2.48",
    "librosa>=0.10.0",
    "soundfile>=0.12.1",
]

yaml = [
    "PyYAML>=6.0",
]

redis = [
    "redis>=5.0",
]

tui = [
    "textual>=0.47.0",
    "platformdirs>=3.0",
]

[project.urls]
Homepage = "https://github.com/edlsh/audio-extraction-analysis"
Repository = "https://github.com/edlsh/audio-extraction-analysis.git"
Documentation = "https://github.com/edlsh/audio-extraction-analysis#readme"
"Bug Tracker" = "https://github.com/edlsh/audio-extraction-analysis/issues"

[project.scripts]
audio-extraction-analysis = "src.cli:main"
audio-extraction = "src.cli:main"

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.build.targets.wheel]
packages = ["src"]

[tool.black]
line-length = 100

[tool.ruff]
line-length = 100
preview = true

[tool.ruff.lint]
select = ["E","F","I","UP","N","B","S","RUF"]
ignore = [
  "S101",  # asserts allowed in tests
  "S102",  # exec-builtin (used in tests for dynamic imports)
  "S108",  # hardcoded-temp-file (acceptable in tests)
  "S110",  # try-except-pass (acceptable in cleanup code)
  "S311",  # suspicious-non-cryptographic-random-usage (not used for crypto)
  "S404",  # subprocess module import (used safely in controlled contexts)
  "S602",  # subprocess-popen-with-shell-equals-true (careful usage in scripts)
  "S603",  # subprocess-without-shell-equals-true (acceptable in scripts)
  "S607",  # start-process-with-partial-path (system binaries like pytest)
  "S608",  # hardcoded-sql-expression (not actual SQL injection risk)
  "B023",  # function-uses-loop-variable (acceptable pattern in tests)
  "B904",  # raise-without-from-inside-except (acceptable in some contexts)
  "B018",  # useless-expression (false positive in some test patterns)
  "N802",  # invalid-function-name (Config properties for compatibility)
  "N806",  # non-lowercase-variable-in-function (acceptable for type names)
  "N812",  # lowercase-imported-as-non-lowercase (acceptable for compatibility)
  "N817",  # camelcase-imported-as-acronym (acceptable for common abbreviations)
  "E402",  # module-import-not-at-top-of-file (required for some lazy imports)
  "E501",  # line-too-long (handled by black, remaining are test data/strings)
  "F401",  # unused-import (many are for availability checks, not actual imports)
  "F821",  # undefined-name (false positives in dynamic contexts)
  "RUF012", # mutable-class-default (acceptable with dataclasses)
  "RUF029", # async function without await (acceptable for test mocks)
  "RUF034", # useless-if-else (false positive)
]

[tool.pytest.ini_options]
addopts = "-q"
testpaths = ["tests"]
pythonpath = ["."]
asyncio_mode = "strict"

[tool.importlinter]
root_package = "src"

[[tool.importlinter.contracts]]
name = "Layered architecture: CLI should not import from providers"
type = "layers"
layers = [
    "src.cli",
    "src.services",
    "src.providers",
]

[[tool.importlinter.contracts]]
name = "Config independence"
type = "independence"
modules = [
    "src.config",
]

[[tool.importlinter.contracts]]
name = "No circular imports in utils"
type = "independence"
modules = [
    "src.utils",
]

[[tool.importlinter.contracts]]
name = "TUI must not import CLI"
type = "forbidden"
source_modules = [
    "src.ui.tui",
]
forbidden_modules = [
    "src.cli",
]

[[tool.importlinter.contracts]]
name = "TUI uses provider factory only"
type = "layers"
layers = [
    "src.ui.tui",
    "src.providers.factory",
]
